<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>Creador de Tiendas ‚Äì Vidriera Virtual</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="stylecreador.css">

</head>

<body>
  <!-- =========================
     üîê LOGIN (GATE)
========================= -->
  <div id="loginGate" class="login-gate">
    <div class="login-card">
      <h2>üîê Ingreso al Creador</h2>
      <p class="login-sub">Ingres√° con tu usuario y contrase√±a.</p>

      <label for="loginUser">Usuario</label>
      <input id="loginUser" type="text" placeholder="admin" autocomplete="username" />

      <label for="loginPass">Contrase√±a</label>
      <div class="pass-wrap">
        <input id="loginPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
        <button id="togglePass" class="btn-eye" type="button" aria-label="Mostrar contrase√±a">üëÅÔ∏è</button>
      </div>

      <div class="login-row">
        <label class="check">
          <input id="rememberMe" type="checkbox" />
          Recordarme
        </label>
        <button id="btnLogin" class="btn-login" type="button">Ingresar</button>
      </div>

      <div id="loginMsg" class="login-msg"></div>
    </div>
  </div>

  <div class="wrap" id="appWrap">

    <h1>‚ö° Creador de Tiendas Vidriera Virtual </h1>

    <button id="btnLogout" class="btn-logout" type="button" style="display:none;">
      üîí Cerrar sesi√≥n
    </button>

    <div class="form-group">
      <label>Seleccion√° tu plan</label>
      <select id="plan" required style="font-size: 12px; padding: 10px; height: 35px;">

        <option value="Basico">B√°sico</option>
        <option value="Profesional">Profesional</option>
        <option value="Premium">Premium</option>
      </select>
    </div>

    <!-- üí° Mensaje din√°mico del plan -->
    <p id="infoPlan" style="color:#0b5ed7; font-weight:bold; margin-top:5px; margin-bottom:10px;">
      üîπ Seleccion√° un plan para ver sus l√≠mites de productos.
    </p>


    <div class="form-group">
      <label>Tipo de tienda</label>
      <select id="rubro" required style="font-size: 12px; padding: 10px; height: 35px;">
        <option value="">-- Seleccionar rubro --</option>
        <option value="carniceria">Carnicer√≠a</option>
        <option value="verduleria">Verduler√≠a</option>
        <option value="polleria">Poller√≠a</option>
        <option value="kiosko">Kiosko</option>
        <option value="ropa">Tienda de Ropa</option>
        <option value="mates">Mates y artesan√≠as</option>
        <option value="panaderia">Panaderia</option>
        <option value="rostiseria">Rostiseria</option>
      </select>
    </div>


    <div class="card">
      <div class="row">
        <div>
          <label>ID Tienda </label>
          <input id="tiendaId" placeholder="MATES-GUAY-LOCAL-12" />
        </div>
        <div>
          <label>Nombre p√∫blico</label>
          <input id="nombre" placeholder="Mates Guay ‚Äì Local 12" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>WhatsApp</label>
          <input id="whatsapp" placeholder="34429649" />
        </div>
        <div>
          <label>Imagen para redes </label>
          <input id="metaImage" placeholder="https://.../600x315.png" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>Calle</label>
          <input id="direccionCalle" placeholder="San Mart√≠n" />
        </div>
        <div>
          <label>N√∫mero</label>
          <input id="direccionNumero" placeholder="123" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>Localidad</label>
          <input id="direccionLocalidad" placeholder="Gualeguay" />
        </div>
        <div>
          <label>Provincia</label>
          <input id="direccionProvincia" placeholder="Entre R√≠os" />
        </div>
      </div>

      <div class="row">
        <div style="width:100%;">
          <label>Horarios</label>

          <!-- ‚úÖ Campo oculto para compatibilidad (se llena solo) -->
          <input id="horarios" type="hidden" />

          <div class="horarios-wrap"
            style="border:1px solid #e5e7eb; border-radius:12px; padding:12px; display:grid; gap:12px;">

            <!-- Lunes a Viernes -->
            <div style="border:1px dashed #d1d5db; border-radius:12px; padding:12px;">
              <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
                <strong>üóìÔ∏è Lunes a Viernes</strong>
                <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                  <input type="checkbox" id="lv_cerrado">
                  Cerrado
                </label>
              </div>

              <div class="horarios-grid-4"
                style="display:grid; grid-template-columns: repeat(4, minmax(120px, 1fr)); gap:10px; margin-top:10px;">

                <div>
                  <label style="font-size:12px;">Desde (ma√±ana)</label>
                  <input type="time" id="lv_desde1">
                </div>
                <div>
                  <label style="font-size:12px;">Hasta (ma√±ana)</label>
                  <input type="time" id="lv_hasta1">
                </div>
                <div>
                  <label style="font-size:12px;">Desde (tarde)</label>
                  <input type="time" id="lv_desde2">
                </div>
                <div>
                  <label style="font-size:12px;">Hasta (tarde)</label>
                  <input type="time" id="lv_hasta2">
                </div>
              </div>
            </div>

            <!-- S√°bado -->
            <div style="border:1px dashed #d1d5db; border-radius:12px; padding:12px;">
              <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
                <strong>üóìÔ∏è S√°bado</strong>
                <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                  <input type="checkbox" id="sa_cerrado">
                  Cerrado
                </label>
              </div>

              <div class="horarios-grid-4"
                style="display:grid; grid-template-columns: repeat(4, minmax(120px, 1fr)); gap:10px; margin-top:10px;">

                <div>
                  <label style="font-size:12px;">Desde (ma√±ana)</label>
                  <input type="time" id="sa_desde1">
                </div>
                <div>
                  <label style="font-size:12px;">Hasta (ma√±ana)</label>
                  <input type="time" id="sa_hasta1">
                </div>
                <div>
                  <label style="font-size:12px;">Desde (tarde)</label>
                  <input type="time" id="sa_desde2">
                </div>
                <div>
                  <label style="font-size:12px;">Hasta (tarde)</label>
                  <input type="time" id="sa_hasta2">
                </div>
              </div>
            </div>

            <!-- Domingo -->
            <div style="border:1px dashed #d1d5db; border-radius:12px; padding:12px;">
              <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
                <strong>üóìÔ∏è Domingo</strong>
                <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                  <input type="checkbox" id="do_cerrado" checked>
                  Cerrado
                </label>
              </div>

              <div class="horarios-grid-4"
                style="display:grid; grid-template-columns: repeat(4, minmax(120px, 1fr)); gap:10px; margin-top:10px;">

                <div>
                  <label style="font-size:12px;">Desde (ma√±ana)</label>
                  <input type="time" id="do_desde1" disabled>
                </div>
                <div>
                  <label style="font-size:12px;">Hasta (ma√±ana)</label>
                  <input type="time" id="do_hasta1" disabled>
                </div>
                <div>
                  <label style="font-size:12px;">Desde (tarde)</label>
                  <input type="time" id="do_desde2" disabled>
                </div>
                <div>
                  <label style="font-size:12px;">Hasta (tarde)</label>
                  <input type="time" id="do_hasta2" disabled>
                </div>
              </div>
            </div>


          </div>
        </div>
      </div>



      <!-- Logo -->
      <label>Logo de la tienda</label>
      <input id="logoUrl" placeholder="https://.../logo.png (opcional)">
      <p style="font-size:0.85em; opacity:0.8;">O sub√≠ una imagen desde tu dispositivo:</p>
      <input type="file" id="logoFile" accept="image/*">
      <img id="preview-logo-upload" src="" alt="Vista previa del logo"
        style="max-height:80px; margin-top:10px; display:none; border-radius:8px;">

      <!-- üé® Paleta de colores -->
      <h3 style="margin-top:20px;">üé® Personalizaci√≥n de colores</h3>
      <div class="row">
        <div>
          <label>Color banner superior</label>
          <input id="colorHeader" type="color" value="#007bff" />
        </div>
        <div>
          <label>Color de nombre de tienda</label>
          <input id="colorHeaderText" type="color" value="#ffffff" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>Color banner inferior</label>
          <input id="colorFooter" type="color" value="#003366" />
        </div>
        <div>
          <label>Color datos de contactos</label>
          <input id="colorFooterText" type="color" value="#ffffff" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>Color del bot√≥n del carrito</label>
          <input id="colorBoton" type="color" value="#20f1f5" />
        </div>
      </div>

      <button id="crear">Crear tienda</button>
      <div id="msg" class="ok"></div>
    </div>

    <!-- üëÄ Vista previa -->
    <div class="card" style="margin-top:25px;">
      <h3>üëÄ Vista previa en vivo</h3>
      <div id="preview" style="border:1px solid #333; border-radius:10px; overflow:hidden;">
        <header id="preview-header" style="background:#007bff; color:white; padding:15px; text-align:center;">
          <img id="preview-logo" src="" alt="" style="max-height:60px; vertical-align:middle; margin-right:10px;">
          <span id="preview-nombre" style="font-size:1.5em; font-weight:700;">Tu tienda</span>
        </header>
        <main style="padding:20px; background:#f7f7f7; color:#222;">
          <p>üßâ As√≠ se ver√° tu tienda digital.</p>
          <div id="preview-info" style="margin-top:20px; font-size:0.95em;">
            <!-- üõçÔ∏è Vista previa de productos -->
            <div id="preview-productos"
              style="margin-top:25px; display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:12px;">
            </div>

            <p><strong>üìç Direcci√≥n:</strong> <span id="preview-direccion">Sin direcci√≥n</span></p>
            <p><strong>üïí Horario:</strong> <span id="preview-horario">Sin horario</span></p>
            <p><strong>üì± WhatsApp:</strong> <span id="preview-whatsapp">---</span></p>
          </div>
        </main>
        <footer id="preview-footer" style="background:#003366; color:white; text-align:center; padding:10px;">
          <small>¬© 2025 Tu Tienda</small>
        </footer>
      </div>
    </div>



    <div class="card">
      <h3>Links r√°pidos</h3>
      <p class="small">Se mostrar√°n cuando la tienda est√© creada:</p>
      <div class="grid">
        <div>üîó Tienda p√∫blica: <a id="linkPublico" class="link" target="_blank"></a></div>
        <div>üõ†Ô∏è Panel admin: <a id="linkAdmin" class="link" target="_blank"></a></div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";
    import { getFirestore, doc, setDoc, collection, addDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA36uwBk0FBDc6rI16BAsqUNe_AXLpv62Q",
      authDomain: "carniceriadonjose-48638.firebaseapp.com",
      projectId: "carniceriadonjose-48638",
      storageBucket: "carniceriadonjose-48638.appspot.com",
      messagingSenderId: "322531750471",
      appId: "1:322531750471:web:78e290c9c81eecc7be3762"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);
    const el = id => document.getElementById(id);

    // =========================
    // üîê LOGIN SIMPLE (Front-end)
    // =========================

    // ‚úÖ Cambi√° estos datos por los tuyos
    const AUTH_USERS = [
      { user: "admin", pass: "1234",
        user: "admin", pass: "Josema"
       },
      // { user: "jose", pass: "miClaveSegura" },
    ];

    const AUTH_KEY = "vv_creador_login_ok";

    const appWrap = document.getElementById("appWrap");
    const gate = document.getElementById("loginGate");
    const loginMsg = document.getElementById("loginMsg");
    const btnLogout = document.getElementById("btnLogout");

    function setAppVisible(isLogged) {
      if (isLogged) {
        gate.style.display = "none";
        appWrap.style.display = "block";
        btnLogout.style.display = "inline-flex";
      } else {
        gate.style.display = "flex";
        appWrap.style.display = "none";
        btnLogout.style.display = "none";
      }
    }

    function isLogged() {
      return localStorage.getItem(AUTH_KEY) === "1";
    }

    function doLogin() {
      const u = (document.getElementById("loginUser").value || "").trim();
      const p = (document.getElementById("loginPass").value || "").trim();
      const remember = document.getElementById("rememberMe").checked;

      const ok = AUTH_USERS.some(x => x.user === u && x.pass === p);

      if (!ok) {
        loginMsg.textContent = "‚ùå Usuario o contrase√±a incorrectos.";
        loginMsg.classList.remove("ok");
        loginMsg.classList.add("bad");
        return;
      }

      loginMsg.textContent = "‚úÖ Acceso permitido.";
      loginMsg.classList.remove("bad");
      loginMsg.classList.add("ok");

      if (remember) localStorage.setItem(AUTH_KEY, "1");
      else sessionStorage.setItem(AUTH_KEY, "1");

      setAppVisible(true);
    }

    function doLogout() {
      localStorage.removeItem(AUTH_KEY);
      sessionStorage.removeItem(AUTH_KEY);

      // limpiar inputs (opcional)
      document.getElementById("loginUser").value = "";
      document.getElementById("loginPass").value = "";
      document.getElementById("rememberMe").checked = false;
      loginMsg.textContent = "";

      setAppVisible(false);
    }

    // Mostrar/Ocultar password üëÅÔ∏è
    const togglePass = document.getElementById("togglePass");
    togglePass.addEventListener("click", () => {
      const inp = document.getElementById("loginPass");
      const isPass = inp.type === "password";
      inp.type = isPass ? "text" : "password";
      togglePass.textContent = isPass ? "üôà" : "üëÅÔ∏è";
    });

    // Enter para ingresar
    ["loginUser", "loginPass"].forEach(id => {
      document.getElementById(id).addEventListener("keydown", (e) => {
        if (e.key === "Enter") doLogin();
      });
    });

    document.getElementById("btnLogin").addEventListener("click", doLogin);
    btnLogout.addEventListener("click", doLogout);

    // Estado inicial
    setAppVisible(localStorage.getItem(AUTH_KEY) === "1" || sessionStorage.getItem(AUTH_KEY) === "1");


    // Mostrar info del plan seleccionado
    el("plan").addEventListener("change", () => {
      const plan = el("plan").value;
      if (plan === "Basico") el("infoPlan").textContent = "üîπ El plan B√°sico cargar√° solo 40 productos.";
      if (plan === "Profesional") el("infoPlan").textContent = "üíº El plan Profesional cargar√° hasta 100 productos.";
      if (plan === "Premium") el("infoPlan").textContent = "üöÄ El plan Premium cargar√° todos los productos disponibles.";
    });


    // funcion del horario
    function setDisabledGrupo(prefix, disabled) {
      ["desde1", "hasta1", "desde2", "hasta2"].forEach(k => {
        const elx = document.getElementById(`${prefix}_${k}`);
        if (elx) elx.disabled = disabled;
      });
    }

    function getGrupo(prefix, label) {
      const cerrado = document.getElementById(`${prefix}_cerrado`)?.checked ?? false;

      const desde1 = document.getElementById(`${prefix}_desde1`)?.value || "";
      const hasta1 = document.getElementById(`${prefix}_hasta1`)?.value || "";
      const desde2 = document.getElementById(`${prefix}_desde2`)?.value || "";
      const hasta2 = document.getElementById(`${prefix}_hasta2`)?.value || "";

      return {
        label,
        cerrado,
        turnos: [
          { desde: desde1, hasta: hasta1 },
          { desde: desde2, hasta: hasta2 }
        ]
      };
    }

    function formatearTurno(t) {
      if (!t?.desde || !t?.hasta) return "";
      return `${t.desde} a ${t.hasta}`;
    }

    function construirHorarioTexto(h) {
      // h = { lv:..., sa:..., do:... }
      const partes = [];

      const pushGrupo = (g) => {
        if (!g) return;
        if (g.cerrado) {
          partes.push(`${g.label}: Cerrado`);
          return;
        }
        const t1 = formatearTurno(g.turnos?.[0]);
        const t2 = formatearTurno(g.turnos?.[1]);
        const turnosTxt = [t1, t2].filter(Boolean).join(" y ");
        partes.push(`${g.label}: ${turnosTxt || "Horario no definido"}`);
      };

      pushGrupo(h.lv);
      pushGrupo(h.sa);
      pushGrupo(h.do);

      return partes.join(" ‚Äî ");
    }

    function leerHorariosDetalle() {
      return {
        lv: getGrupo("lv", "Lun a Vie"),
        sa: getGrupo("sa", "S√°b"),
        do: getGrupo("do", "Dom")
      };
    }

    function actualizarHorariosEnHiddenYPreview() {
      const detalle = leerHorariosDetalle();
      const texto = construirHorarioTexto(detalle);

      // ‚úÖ compatibilidad: el #horarios se guarda como string
      const hidden = document.getElementById("horarios");
      if (hidden) hidden.value = texto;

      // ‚úÖ vista previa
      const prev = document.getElementById("preview-horario");
      if (prev) prev.textContent = texto || "Sin horario";
    }

    // üì¶ CREAR TIENDA
    async function crearTienda() {
      const tiendaId = (el("tiendaId").value || "").trim();
      const nombre = (el("nombre").value || "").trim();
      const whatsapp = (el("whatsapp").value || "").trim();

      // üì∏ L√≥gica combinada de logo
      let logoUrlFinal = "";
      const file = el("logoFile").files[0];
      const linkManual = el("logoUrl").value.trim();

      if (file) {
        const storageRef = ref(storage, `logos/${tiendaId}/${file.name}`);
        await uploadBytes(storageRef, file);
        logoUrlFinal = await getDownloadURL(storageRef);
      } else if (linkManual) {
        logoUrlFinal = linkManual;
      } else {
        // üîπ Logo sugerido seg√∫n rubro (con URLs absolutas)
        const rubroSeleccionado = el("rubro").value;
        const logosSugeridos = {
          carniceria: "https://jumboargentina.vtexassets.com/arquivos/ids/447446/Patamuslo-De-Pollo-X-Kg-1-247723.jpg?v=636559053608600000",
          verduleria: "https://josema1031.github.io/multitiendas/logos/verduleria.png",
          polleria: "https://josema1031.github.io/multitiendas/logos/polleria.png",
          kiosko: "https://josema1031.github.io/multitiendas/logos/kiosko.png",
          panaderia: "https://josema1031.github.io/multitiendas/logos/panaderia.png",
          rostiseria: "https://josema1031.github.io/multitiendas/logos/rostiseria.png",
          ropa: "https://josema1031.github.io/multitiendas/logos/ropa.png",
          mates: "https://josema1031.github.io/multitiendas/logos/mates.png"
        };
        logoUrlFinal = logosSugeridos[rubroSeleccionado] || "https://placehold.co/300x300?text=Sin+Logo";
      }

      const direccionCalle = (el("direccionCalle").value || "").trim();
      const direccionNumero = (el("direccionNumero").value || "").trim();
      const direccionLocalidad = (el("direccionLocalidad").value || "").trim();
      const direccionProvincia = (el("direccionProvincia").value || "").trim();

      // (compatibilidad) armamos un string ‚Äúdireccion‚Äù como antes
      const direccion = [
        [direccionCalle, direccionNumero].filter(Boolean).join(" ").trim(),
        direccionLocalidad,
        direccionProvincia
      ].filter(Boolean).join(", ");


      // ‚úÖ Generar horarios desde Opci√≥n A (y llenar #horarios)
      const horariosDetalle = leerHorariosDetalle();
      actualizarHorariosEnHiddenYPreview(); // asegura #horarios actualizado

      const horarios = (el("horarios").value || "").trim();
      const metaImage = (el("metaImage").value || "").trim();
      const colorHeader = el("colorHeader").value;
      const colorFooter = el("colorFooter").value;
      const colorHeaderText = el("colorHeaderText").value;
      const colorFooterText = el("colorFooterText").value;
      const colorBoton = el("colorBoton").value;
      const plan = el("plan").value;
      const rubro = el("rubro").value;

      if (!tiendaId || !nombre || !whatsapp) {
        el("msg").innerHTML = "‚ùå Complet√° Tienda ID, Nombre y WhatsApp.";
        return;
      }

      // ‚úÖ Evitar guardar valor vac√≠o en Firestore
      if (!logoUrlFinal || logoUrlFinal.trim() === "") {
        logoUrlFinal = "https://placehold.co/300x300?text=Sin+Logo";
      }

      const configRef = doc(db, "tiendas", tiendaId, "config", "datos");
      const configSnap = await getDoc(configRef);

      if (configSnap.exists()) {
        const confirmar = confirm(`‚ö†Ô∏è La tienda "${tiendaId}" ya existe.\n¬øQuer√©s actualizar su plan y configuraci√≥n?`);
        if (!confirmar) return;

        await updateDoc(configRef, {
          plan,
          nombre,
          whatsapp,
          direccion, // (string armado)
          direccionCalle,
          direccionNumero,
          direccionLocalidad,
          direccionProvincia,
          horarios,
          colorHeader,
          colorFooter,
          colorHeaderText,
          colorFooterText,
          colorBoton,
          logo: logoUrlFinal,
          rubro
        });


        alert("‚úÖ Tienda actualizada correctamente");
        return;
      }

      // üîπ Guardar configuraci√≥n inicial
      await setDoc(doc(db, "tiendas", tiendaId, "config", "datos"), {
        nombre,
        whatsapp,
        direccion, // (string armado)
        direccionCalle,
        direccionNumero,
        direccionLocalidad,
        direccionProvincia,
        horarios,
        logo: logoUrlFinal,
        colorHeader,
        colorFooter,
        colorHeaderText,
        colorFooterText,
        colorBoton,
        plan,
        rubro
      });


      // ‚úÖ Documento ra√≠z
      await setDoc(doc(db, "tiendas", tiendaId), { creado: new Date().toISOString() });


      // üßâ Cargar productos iniciales seg√∫n el rubro
      const productosRef = collection(db, "tiendas", tiendaId, "productos");

      if (rubro) {
        try {
          const response = await fetch(`plantillas/${rubro}.json`);
          let productosBase = await response.json();

          // üü¶ Obtener el plan y aplicar l√≠mite
          let limite = 0;
          if (plan === "Basico") limite = 40;
          else if (plan === "Profesional") limite = 100;
          else if (plan === "Premium") limite = Infinity;

          // ‚úÇÔ∏è Recortar productos seg√∫n el l√≠mite del plan
          if (limite !== Infinity && productosBase.length > limite) {
            productosBase = productosBase.slice(0, limite);
            console.warn(`‚ö†Ô∏è Plan ${plan}: solo se cargar√°n ${limite} productos de ${productosBase.length} disponibles.`);
          }

          // üîÑ Subir productos limitados a Firestore
          for (const p of productosBase) {
            await addDoc(productosRef, p);
          }

          console.log(`‚úÖ Cargados ${productosBase.length} productos (${plan}) para ${rubro}`);
        } catch (error) {
          console.warn("‚ö†Ô∏è No se pudieron cargar los productos predeterminados:", error);
        }
      } else {
        // Si no se seleccion√≥ rubro, cargar productos demo gen√©ricos
        const demo = [
          { nombre: "Mate Imperial", precio: 18000, categoria: "Imperial", imagen: logoUrlFinal, stock: 10, orden: 0 },
          { nombre: "Bombilla de acero", precio: 5000, categoria: "Oferta", imagen: "https://placehold.co/300x300?text=Producto", stock: 20, orden: 1 },
          { nombre: "Combo mate + bombilla", precio: 21000, categoria: "Combo", imagen: "https://placehold.co/300x300?text=Producto", stock: 5, orden: 2 }
        ];
        for (const p of demo) await addDoc(productosRef, p);
        console.log("üß© Cargados productos demo por defecto (sin rubro)");
      }



      // üåê Generar enlaces
      const base = window.location.origin + window.location.pathname.replace("creador.html", "");
      const linkPublico = `${base}index.html?tienda=${encodeURIComponent(tiendaId)}`;
      const linkAdmin = `${base}admin.html?tienda=${encodeURIComponent(tiendaId)}`;

      el("linkPublico").href = linkPublico;
      el("linkPublico").textContent = linkPublico;
      el("linkAdmin").href = linkAdmin;
      el("linkAdmin").textContent = linkAdmin;



      el("msg").innerHTML = "‚úÖ ¬°Tienda creada! Ya pod√©s abrir los links.";
    }



    el("crear").addEventListener("click", crearTienda);
    // ‚úÖ Horarios Opci√≥n A: habilitar/deshabilitar por "Cerrado"
    ["lv", "sa", "do"].forEach(prefix => {
      const chk = document.getElementById(`${prefix}_cerrado`);
      if (chk) {
        chk.addEventListener("change", () => {
          setDisabledGrupo(prefix, chk.checked);
          actualizarHorariosEnHiddenYPreview();
          actualizarVistaPrevia(); // mantiene tu preview general
        });

        // estado inicial
        setDisabledGrupo(prefix, chk.checked);
      }

      // escuchar cambios en los time inputs
      ["desde1", "hasta1", "desde2", "hasta2"].forEach(k => {
        const inp = document.getElementById(`${prefix}_${k}`);
        if (inp) inp.addEventListener("input", () => {
          actualizarHorariosEnHiddenYPreview();
          actualizarVistaPrevia();
        });
      });
    });

    // inicial
    actualizarHorariosEnHiddenYPreview();


    // üé® VISTA PREVIA DE PRODUCTOS POR RUBRO
    function mostrarProductosPreview() {
      const rubro = el("rubro").value;
      const contenedor = el("preview-productos");
      contenedor.innerHTML = "";
      // üü¶ NUEVO: GRID RESPONSIVE (2 columnas en celular)
      contenedor.style.display = "grid";
      contenedor.style.gridTemplateColumns = "repeat(2, 1fr)";
      contenedor.style.gap = "12px";


      const ejemplos = {
        carniceria: [
          { nombre: "Asado de tira", imagen: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRjZ8v07ZRGtRDCvVI5fY8zl-Fmkdm6wsgMv1SMEEcDePFH0tgS0mqed3dnYZCnepnKQ40&usqp=CAU" },
          { nombre: "Chorizo parrillero", imagen: "https://static.cotodigital3.com.ar/sitios/fotos/large/00048200/00048297.jpg" },
          { nombre: "Vac√≠o", imagen: "https://arjosimarprod.vtexassets.com/arquivos/ids/155595/Vacio-de-Novillito-Kg-1-5801.jpg?v=637377692913400000" },
          { nombre: "Matambre", imagen: "https://i.postimg.cc/XJdbjWp6/matambre.jpg" }
        ],
        verduleria: [
          { nombre: "Tomate", imagen: "https://static.cotodigital3.com.ar/sitios/fotos/large/00000600/00000684.jpg" },
          { nombre: "Lechuga", imagen: "https://static.cotodigital3.com.ar/sitios/fotos/large/00000600/00000649.jpg" },
          { nombre: "Papa Blanca", imagen: "https://static.cotodigital3.com.ar/sitios/fotos/large/00000600/00000695.jpg" },
          { nombre: "Pimiento rojo ", imagen: "https://static.cotodigital3.com.ar/sitios/fotos/large/00000600/00000671.jpg" }

        ],
        polleria: [
          { nombre: "Pechuga de pollo", imagen: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSrSRZK0_phB30velCX3dsYfEBVmfV1RnEcKw&s" },
          { nombre: "Pollo entero fresco", imagen: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSrSRZK0_phB30velCX3dsYfEBVmfV1RnEcKw&s" },
          { nombre: "Maple de Huevos", imagen: "https://polleriakaserito.com/wp-content/uploads/2023/09/huevo-m30-324x324.jpg.png.webp" },
          { nombre: "Pollo trozado", imagen: "https://eresloquecomes.com.ar/341-large_default/pollo-trozado-en-cuatro-213kg-aprox-coeco.jpg" }
        ],
        kiosko: [
          { nombre: "Gaseosa Sprite 1.5L", imagen: "https://toledodigitalar.vtexassets.com/arquivos/ids/182765-800-auto?v=638824195032170000&width=800&height=auto&aspect=true" },
          { nombre: "Alfajor Triple Fantoche", imagen: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSUbVhwQlBaF6G3i_IuF6mhcXXnbw8cLGr-sg&s" },
          { nombre: "Galletitas Oreo", imagen: "https://hiperlibertad.vtexassets.com/arquivos/ids/226836/Galletitas-Oreo-Sabor-Vainilla-Rellenas-con-Crema-118g-4-21720.jpg?v=638531985753400000" },
          { nombre: "Papas fritas Lays 230g", imagen: "https://http2.mlstatic.com/D_Q_NP_984148-MLA92710649571_092025-O.webp" }
        ],
        panaderia: [
          { nombre: "Medialunas de Manteca", imagen: "https://arcordiezb2c.vteximg.com.br/arquivos/ids/161523/Medialuna-Manteca-Pastelino-x-Kg-1-5840.jpg?v=637469298083300000" },
          { nombre: "Pan Franc√©s", imagen: "https://jumboargentina.vtexassets.com/arquivos/ids/473268-800-600?v=636695580460800000&width=800&height=600&aspect=true" },
          { nombre: "Pastelitos de Membrillo", imagen: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQYibWFXz2UcHCNQhn1P8pkHDtqmNiZ2UumAQ&s" },
          { nombre: "Pan Integral", imagen: "https://static.vecteezy.com/system/resources/previews/011/044/886/non_2x/whole-grain-bread-on-white-background-free-photo.jpg" }
        ],
        rostiseria: [
          { nombre: "Tarta de jam√≥n y queso", imagen: "https://i.postimg.cc/yxHZ8fxw/2021-11-03-62278279.jpg" },
          { nombre: "Pizza muzzarella", imagen: "https://media.istockphoto.com/id/905492462/es/foto/pizza-margarita-con-queso-mozzarella-albahaca-y-tomate-plantilla-para-su-dise%C3%B1o-y-el-men%C3%BA-del.jpg?s=612x612&w=0&k=20&c=EzqqfeA5rZ87NktFgIo6vgNWfZlO037uP4JtvVx3HhY=" },
          { nombre: "Papas fritas porci√≥n", imagen: "https://i.postimg.cc/YCkbs332/29580407-portion-of-hot-french-fries-on-a-white-background.jpg" },
          { nombre: "Lasagna de carne", imagen: "https://thumbs.dreamstime.com/b/plancha-de-la-pieza-lasagna-sobre-fondo-blanco-plato-lona-con-carne-picada-y-queso-fundido-al-171715395.jpg" }
        ],
        ropa: [
          { nombre: "Remera b√°sica", imagen: "https://cdn.pixabay.com/photo/2016/03/27/21/16/t-shirt-1281840_1280.jpg" },
          { nombre: "Pantal√≥n jean", imagen: "https://cdn.pixabay.com/photo/2016/11/22/22/18/jeans-1853970_1280.jpg" }
        ],
        mates: [
          { nombre: "Mate Imperial", imagen: "https://cdn.pixabay.com/photo/2020/07/06/16/58/mate-5379305_1280.jpg" },
          { nombre: "Bombilla acero", imagen: "https://cdn.pixabay.com/photo/2018/09/04/21/55/bombilla-3656620_1280.jpg" }
        ]
      };

      if (!rubro || !ejemplos[rubro]) return;

      ejemplos[rubro].forEach(p => {
        const card = document.createElement("div");
        card.style.background = "#fff";
        card.style.borderRadius = "10px";
        card.style.padding = "10px";
        card.style.textAlign = "center";
        card.style.boxShadow = "0 3px 8px rgba(0,0,0,0.15)";
        card.innerHTML = `
        <img src="${p.imagen}" alt="${p.nombre}" 
     style="width:100%;height:120px;object-fit:contain;border-radius:8px;background:#fff;display:block;margin:auto;">
      <p style="margin-top:8px;font-size:0.9em;color:#111;">${p.nombre}</p>`;
        contenedor.appendChild(card);
      });
    }





    // üîÑ Evento al cambiar rubro
    el("rubro").addEventListener("change", mostrarProductosPreview);

    // ü™Ñ Vista previa en vivo
    function actualizarVistaPrevia() {
      const nombre = el("nombre").value || "Tu tienda";
      const linkLogo = el("logoUrl").value.trim();
      const file = el("logoFile").files[0];

      const colorHeader = el("colorHeader").value;
      const colorHeaderText = el("colorHeaderText").value;
      const colorFooter = el("colorFooter").value;
      const colorFooterText = el("colorFooterText").value;
      const colorBoton = el("colorBoton").value;

      const direccionCalle = el("direccionCalle")?.value || "";
      const direccionNumero = el("direccionNumero")?.value || "";
      const direccionLocalidad = el("direccionLocalidad")?.value || "";
      const direccionProvincia = el("direccionProvincia")?.value || "";

      const direccion = [
        [direccionCalle, direccionNumero].filter(Boolean).join(" ").trim(),
        direccionLocalidad,
        direccionProvincia
      ].filter(Boolean).join(", ") || "Sin direcci√≥n";

      const horarios = el("horarios").value || "Sin horario";
      const whatsapp = el("whatsapp").value || "---";


      // HEADER PROFESIONAL CON LOGO DESTACADO
      const header = document.getElementById("preview-header");
      header.style.display = "flex";
      header.style.alignItems = "center";
      header.style.justifyContent = "center";
      header.style.gap = "18px";
      header.style.padding = "20px";
      header.style.background = colorHeader;
      header.style.color = colorHeaderText;
      header.style.borderBottom = "2px solid rgba(255,255,255,0.25)";
      header.style.flexWrap = "wrap";

      // T√çTULO
      const nombreEl = document.getElementById("preview-nombre");
      nombreEl.textContent = nombre;
      nombreEl.style.color = colorHeaderText;
      nombreEl.style.fontSize = "2.2rem";
      nombreEl.style.fontWeight = "800";
      nombreEl.style.margin = "0";
      nombreEl.style.textShadow = "0 2px 4px rgba(0,0,0,0.3)";

      // LOGO GRANDE
      const logoEl = document.getElementById("preview-logo");
      logoEl.style.height = "90px"; // üí™ tama√±o fijo m√°s grande
      logoEl.style.width = "auto";
      logoEl.style.maxHeight = "none"; // elimina limitaci√≥n previa
      logoEl.style.objectFit = "contain";
      logoEl.style.borderRadius = "10px";
      logoEl.style.boxShadow = "0 4px 10px rgba(0,0,0,0.3)";
      logoEl.style.transition = "transform 0.25s ease, filter 0.25s ease";
      logoEl.style.filter = "drop-shadow(0 3px 6px rgba(0,0,0,0.25))";

      logoEl.onmouseover = () => (logoEl.style.transform = "scale(1.08)");
      logoEl.onmouseout = () => (logoEl.style.transform = "scale(1)");

      // Mostrar el logo seg√∫n archivo o link
      if (file) {
        const reader = new FileReader();
        reader.onload = e => {
          logoEl.src = e.target.result;
          logoEl.style.display = "block";
        };
        reader.readAsDataURL(file);
      } else if (linkLogo) {
        logoEl.src = linkLogo;
        logoEl.style.display = "block";
      } else {
        logoEl.style.display = "none";
      }


      // INFO
      document.getElementById("preview-direccion").textContent = direccion;
      document.getElementById("preview-horario").textContent = horarios;
      document.getElementById("preview-whatsapp").textContent = whatsapp;

      // FOOTER
      const footer = document.getElementById("preview-footer");
      footer.style.background = colorFooter;
      footer.style.color = colorFooterText;
      footer.innerHTML = `<small>¬© 2025 ${nombre}</small>`;

      // BOT√ìN DE CARRITO SIMB√ìLICO
      let boton = document.getElementById("preview-boton");
      if (!boton) {
        boton = document.createElement("button");
        boton.id = "preview-boton";
        boton.textContent = "üõí Ver carrito";
        boton.style.marginTop = "-30px";
        document.getElementById("preview-info").appendChild(boton);
      }

      boton.style.float = "right";// üü¶ POSICIONAR A LA DERECHA AL CARRITO
      boton.style.background = colorBoton;
      boton.style.border = "none";
      boton.style.color = "#000";
      boton.style.padding = "10px 20px";
      boton.style.borderRadius = "8px";
      boton.style.fontWeight = "600";
    }

    ["nombre", "logoUrl", "logoFile", "colorHeader", "colorHeaderText", "colorFooter", "colorFooterText", "colorBoton", "direccionCalle", "direccionNumero", "direccionLocalidad", "direccionProvincia", "horarios", "whatsapp", "rubro"].forEach(id => {
      const input = el(id);
      if (input) {
        input.addEventListener("input", () => {
          actualizarVistaPrevia();
          if (id === "rubro") mostrarProductosPreview(); // üîÑ cuando cambie rubro, mostrar productos
        });
        if (input.type === "file") input.addEventListener("change", actualizarVistaPrevia);
      }
    });


    actualizarVistaPrevia();
    mostrarProductosPreview();


  </script>
</body>

</html>